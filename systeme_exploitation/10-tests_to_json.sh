#!/bin/bash

success_tests=()
failure_tests=()

for log_file in TP_ex10/teraterm_*.log
do
    imei=$(grep 'SIM800 IMEI is:' "$log_file" | awk '{print $NF}')
    date=$(head -1 "$log_file" | awk '{print $1}' | tr -d '[]')
    rssi=$(grep 'GSM SIGNAL IS GOOD AND RSSI IS:' "$log_file" | awk '{print $NF}')

    if grep -q 'TEST SUCCEEDED' "$log_file"; then
        success_tests+=("{\"imei\":\"$imei\",\"date\":\"$date\",\"rssi\":\"$rssi\"}")
    else
        failure_tests+=("{\"imei\":\"$imei\",\"date\":\"$date\"}")
    fi
done

echo "{\"success\":[$(IFS=,; echo "${success_tests[*]}")],\"failure\":[$(IFS=,; echo "${failure_tests[*]}")]}" > teraterm_output.json